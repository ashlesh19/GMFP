<!DOCTYPE html>
<html lang="en" xmlns:th="https://www.thymeleaf.org" xmlns="http://www.w3.org/1999/html">

<head>
  <title>Gearbox Maintenance Failure Prediction</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
  <link rel="stylesheet" href="css/style.css">
</head>

<body>
  <script>
    var readRows;
    var i = 1;
    var gStatus = "healthy";
    var flag = true;

    $.ajax({
      url: "/getData",
      type: "GET",
      dataType: "json",
      success:
        function (data) {
          readRows = data;
        }
    });

    $(document).ready(function () {
      $('.button1').on('click', function () {

        setInterval(function () {
          $("#tds1").text(readRows[i].s1);
          $("#tds2").text(readRows[i].s2);
          $("#tds3").text(readRows[i].s3);
          $("#tds4").text(readRows[i].s4);
          $("#tdload").text(readRows[i++].load);
          if (readRows[i].s1 < 4) {
            if (gStatus != "healthy") {
              gStatus = "healthy";
            }
          }
          else if (readRows[i].s1 > 4 && readRows[i].s1 < 6) {
            if (gStatus != "Due for Maintenance") {
              gStatus = "Due for Maintenance";
              flag = false;
            }
          }
          else {
            if (gStatus != "Failed") {
              gStatus = "Failed";
              flag = false;
            }
          }
          $("#tdstatus").text(gStatus);
          if (!flag) {
            alert(gStatus);
            flag = true;
          }
        }, 5);

      });
    });
  </script>

  <header>
    <h2>Predictive Maintenance And Failure Prediction</h2>
    <p>This is a simulation application which fetches the sensor readings stored in database and based on applied
      prediction model will generate an output to the user regarding the status of the Gearbox</p>
    <p>Three possible outcomes are: Healthy, Broken and Due for Maintenance</p>
  </header>
  <section>
    <nav>
      <h2>Sensor Readings</h2>

      <table style="width:100%">
        <tr>
          <th>Sensor 1</th>
          <th>Sensor 2</th>
          <th>Sensor 3</th>
          <th>Sensor 4</th>
          <th>Load</th>

        </tr>
        <tr>
          <td>
            <div id="tds1"></div>
          </td>
          <td>
            <div id="tds2"></div>
          </td>
          <td>
            <div id="tds3"></div>
          </td>
          <td>
            <div id="tds4"></div>
          </td>
          <td>
            <div id="tdload"></div>
          </td>
        </tr>
      </table>
      <h1><button class="button button1" />Start <button class="button button2" />Stop</h1>
    </nav>

    <article>
      <h2>Gearbox Status</h2>
      <table style="width:100%">
        <tr>
          <th>Status</th>
        </tr>
        <tr>
          <td>
            <div id="tdstatus"></div>
          </td>
        </tr>
      </table>
    </article>
  </section>

  <footer>
    <p>Footer</p>
  </footer>

</body>

</html>